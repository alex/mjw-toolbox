dmz=em1
ext_if=vether0
int_if=em2
uplink=em0
nodeless="{ 100.36.223.10, \
  100.36.223.11, \
  100.36.223.12, \
  100.36.223.13, \
  100.36.223.14 }"

set skip on { lo, bridge0 }
block drop log

# internet-facing physical interface
# TODO(weaver) : logging here.
pass in on $uplink from any to $nodeless
pass out on $uplink from $nodeless to any

# external interface
pass out on $ext_if nat-to $ext_if:0
pass in on $ext_if proto tcp from any to $ext_if:0 port ssh keep state
pass in on $ext_if inet proto icmp \
  from $nodeless to $ext_if:0 \
  icmp-type 8 code 0 keep state
pass in on $ext_if proto tcp \
  from $nodeless to $ext_if:0 \
  port { domain, https, www, 853 } keep state
pass in on $ext_if proto udp \
  from $nodeless to $ext_if:0 \
  port { domain, ntp } keep state
pass in on $ext_if proto udp from port 68 to port 67
pass out on $ext_if proto udp from port 67 to port 68

# dmz-facing physical interface
pass out on $dmz from any to $nodeless
pass in on $dmz from $nodeless to any

# lan-facing physical interface
pass in on $int_if proto tcp \
  from $int_if:network to $int_if:0 \
  port { domain, https, ssh, www } keep state
pass in on $int_if proto udp \
  from $int_if:network to $int_if:0 \
  port { domain, ntp } keep state
pass in on $int_if proto udp from port 68 to port 67
pass out on $int_if proto udp from port 67 to port 68
